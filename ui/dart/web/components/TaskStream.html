<!DOCTYPE html>

<html>
  <head>
    <title>TaskSummaryLink</title>
  </head>
 
  <body>   
    <element extends="div" name="x-task-stream" constructor="TaskStream">
      <template>
        <template instantiate="if userId > 0">
          <h3>Filter Available Tasks</h3>
          <table>
            <thead>
              <th>Task Type</th>
              <th>Source Language <span style="color: red">*</span></th>
              <th>Target Language <span style="color: red">*</span></th>
            </thead>
            <tbody>
              <tr>
                <td>
                  <select name="taskTypes" bind-selected-index="selectedTaskTypeFilter" 
                    template iterate="key in taskTypeIndexes">
                    <option value="{{key.toString()}}">{{taskTypes[key]}}</option>
                  </select>
                </td>
                <td>
                  <select name="sourceLanguage" bind-selected-index="selectedSourceFilter" 
                    template iterate="language in activeLanguages">
                      <option value="{{language.code}}">{{language.name}}</option>
                  </select>
                </td>
                <td>
                  <select name="targetLanguage" bind-selected-index="selectedTargetFilter" 
                    template iterate="language in activeLanguages">
                    <option value="{{language.code}}">{{language.name}}</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td>
                  <button value="Filter" class="btn btn-primary" on-click="filterStream()">
                    <i class="icon-refresh icon-white"></i> Filter Task Stream
                  </button>
                </td>
              </tr>
            </tbody>  
          </table>
          <br />
          <small>
            <span style="color: red">*</span> Only languages that are active in the system are listed in the filter boxes.
            If your language is not present then please check back again later.
          </small>
          <hr />
        </template>
        <template instantiate="if tasks.length > 0">
          <template iterate="task in tasks">
            <div class="task" style="word-break: break-all; overflow-wrap: break-word;">
              <h2>
                <a href="http://127.0.0.1/Solas-Match/task/{{task.id}}/id">
                  {{task.title}}
                </a>
              </h2>
              <p>Type:
                <template instantiate="if task.taskType == 1">
                  <span class="label label-info" style="background-color: {{taskOneColour}}">Segmentation</span>
                </template>
                <template instantiate="if task.taskType == 2">
                  <span class="label label-info" style="background-color: {{taskTwoColour}}">Translation</span>              
                </template>
                <template instantiate="if task.taskType == 3">
                  <span class="label label-info" style="background-color: {{taskThreeColour}}">Proofreading</span>              
                </template>
                <template instantiate="if task.taskType == 4">
                  <span class="label label-info" style="background-color: {{taskFourColour}}">Desegmentation</span>              
                </template>
              </p>
              <p>
                From: {{task.sourceLocale.languageName}} - {{task.sourceLocale.countryName}}
              </p>
              <p>
                To: {{task.targetLocale.languageName}} - {{task.targetLocale.countryName}}
              </p>
              <p>
                Word Count: <strong>{{task.wordCount}}</strong>
              </p>
              <p class="task_details">
                Added: <strong>{{task.createdTime}}</strong> ago
              </p>
              <p>
                Due by: <strong>{{task.deadline}}</strong>
              </p>
              <template instantiate="if projectMap[task.projectId] != null">
                <template instantiate="if orgMap[projectMap[task.projectId].organisationId] != null">
                  <p>
                    Part of:
                    <a href="http://127.0.0.1/Solas-Match/project/{{projectMap[task.projectId].id}}/view">
                      {{projectMap[task.projectId].title}}
                    </a>
                    for
                    <a href="http://127.0.0.1/Solas-Match/org/{{orgMap[projectMap[task.projectId].organisationId].id}}/profile">
                      {{orgMap[projectMap[task.projectId].organisationId].name}}
                    </a>
                  </p>
                </template>
              </template>
              <br />
            </div>
          </template>
          <template instantiate="if moreTasks">
            <button on-click="addTasks()">Load More</button>
          </template>
        </template>
        <template instantiate="if !(tasks.length > 0)">
          <p>There are no tasks currently available</p>
        </template>
        <br />
      </template>
      <script type="application/dart" src="TaskStream.dart"></script>
    </element>
  </body>
</html>

// Auto-generated from TaskStream.html.
// DO NOT EDIT.

library SolasMatchDart;

import 'dart:html' as autogenerated;
import 'dart:svg' as autogenerated_svg;
import 'package:web_ui/web_ui.dart' as autogenerated;
import 'package:web_ui/observe/observable.dart' as __observe;
import "package:web_ui/web_ui.dart";
import "dart:async";
import "dart:json";
import '../../DataAccessObjects/TaskDao.dart';
import '../../DataAccessObjects/ProjectDao.dart';
import '../../DataAccessObjects/OrgDao.dart';
import '../../DataAccessObjects/LanguageDao.dart';
import '../../lib/models/Task.dart';
import '../../lib/models/Tag.dart';
import '../../lib/models/Project.dart';
import '../../lib/models/Org.dart';
import '../../lib/models/Language.dart';
import '../../lib/Settings.dart';
import '../../lib/Localisation.dart';



class TaskStream extends WebComponent with Observable 
{
  /** Autogenerated from the template. */

  autogenerated.ScopedCssMapper _css;

  /** This field is deprecated, use getShadowRoot instead. */
  get _root => getShadowRoot("x-task-stream");
  static final __html1 = new autogenerated.HRElement(), __html10 = new autogenerated.Element.tag('template'), __html11 = new autogenerated.Element.html('<div class="task" style="word-break: break-all; overflow-wrap: break-word;">\n              <h2>\n                <a></a>\n              </h2>\n              <p></p>\n              <p></p>\n              <p></p>\n              <p>\n                <template></template>\n              </p>\n              <p></p>\n              <p class="task_details"></p>\n              <p></p>\n              <template></template>\n              <br>\n            </div>'), __html12 = new autogenerated.Element.tag('template'), __html13 = new autogenerated.Element.html('<span class="label label-info" style="background-color: {{taskOneColour}}"></span>'), __html14 = new autogenerated.Element.tag('template'), __html15 = new autogenerated.Element.html('<span class="label label-info" style="background-color: {{taskTwoColour}}"></span>'), __html16 = new autogenerated.Element.tag('template'), __html17 = new autogenerated.Element.html('<span class="label label-info" style="background-color: {{taskThreeColour}}"></span>'), __html18 = new autogenerated.Element.tag('template'), __html19 = new autogenerated.Element.html('<span class="label label-info" style="background-color: {{taskFourColour}}"></span>'), __html2 = new autogenerated.Element.tag('h3'), __html20 = new autogenerated.Element.tag('strong'), __html21 = new autogenerated.Element.tag('strong'), __html22 = new autogenerated.Element.tag('template'), __html23 = new autogenerated.Element.html('<a class="label"><span class="label"></span></a>'), __html24 = new autogenerated.Element.tag('strong'), __html25 = new autogenerated.Element.tag('strong'), __html26 = new autogenerated.Element.tag('strong'), __html27 = new autogenerated.Element.tag('template'), __html28 = new autogenerated.ParagraphElement(), __html29 = new autogenerated.AnchorElement(), __html3 = new autogenerated.Element.html('<table>\n            <thead>\n              <tr><th></th>\n              <th></th>\n              <th></th>\n            </tr></thead>\n            <tbody>\n              <tr>\n                <td>\n                  <select name="taskTypes"></select>\n                </td>\n                <td>\n                  <select name="sourceLanguage"></select>\n                </td>\n                <td>\n                  <select name="targetLanguage"></select>\n                </td>\n              </tr>\n              <tr>\n                <td>\n                  <button value="Filter" class="btn btn-primary"></button>\n                </td>\n              </tr>\n            </tbody>  \n          </table>'), __html30 = new autogenerated.AnchorElement(), __html31 = new autogenerated.Element.tag('template'), __html32 = new autogenerated.ButtonElement(), __html33 = new autogenerated.ParagraphElement(), __html4 = new autogenerated.Element.html('<span style="color: red">*</span>'), __html5 = new autogenerated.Element.html('<span style="color: red">*</span>'), __html6 = new autogenerated.OptionElement(), __html7 = new autogenerated.OptionElement(), __html8 = new autogenerated.OptionElement(), __html9 = new autogenerated.Element.html('<i class="icon-refresh icon-white"></i>'), __shadowTemplate = new autogenerated.DocumentFragment.html('''
        <template></template>
        <template></template>
        <template></template>
        <br>
      ''');
  autogenerated.Element __e20, __e79, __e82;
  autogenerated.Template __t;

  void created_autogenerated() {
    var __root = createShadowRoot("x-task-stream");
    setScopedCss("x-task-stream", new autogenerated.ScopedCssMapper({"x-task-stream":"[is=\"x-task-stream\"]"}));
    _css = getScopedCss("x-task-stream");
    __t = new autogenerated.Template(__root);
    __root.nodes.add(__shadowTemplate.clone(true));
    __e20 = __root.nodes[1];
    __t.conditional(__e20, () => userId > 0, (__t) {
      var __e1, __e10, __e13, __e16, __e18, __e19, __e3, __e5, __e7;
      __e1 = __html2.clone(true);
      var __binding0 = __t.contentBind(() => Localisation.getTranslationSafe("index_filter_available_tasks"), false);
      __e1.nodes.add(__binding0);
      __e19 = __html3.clone(true);
      __e3 = __e19.nodes[1].nodes[1].nodes[0];
      var __binding2 = __t.contentBind(() => Localisation.getTranslationSafe("common_task_type"), false);
      __e3.nodes.add(__binding2);
      __e5 = __e19.nodes[1].nodes[1].nodes[2];
      var __binding4 = __t.contentBind(() => Localisation.getTranslationSafe("common_source_language"), false);
      __e5.nodes.addAll([__binding4,
          __html4.clone(true)]);
      __e7 = __e19.nodes[1].nodes[1].nodes[4];
      var __binding6 = __t.contentBind(() => Localisation.getTranslationSafe("common_target_language"), false);
      __e7.nodes.addAll([__binding6,
          __html5.clone(true)]);
      __e10 = __e19.nodes[3].nodes[1].nodes[1].nodes[1];
      __t.listen(__e10.onChange, ($event) { selectedTaskTypeFilter = __e10.selectedIndex; });
      __t.oneWayBind(() => selectedTaskTypeFilter, (e) { if (__e10.selectedIndex != e) __e10.selectedIndex = e; }, false, false);
      __t.loopIterateAttr(__e10, () => taskTypeIndexes, ($list, $index, __t) {
        var key = $list[$index];
        var __e9;
        __e9 = __html6.clone(true);
        var __binding8 = __t.contentBind(() => taskTypes[key], false);
        __e9.nodes.add(__binding8);
        __t.oneWayBind(() => key.toString(), (e) { if (__e9.value != e) __e9.value = e; }, false, false);
      __t.addAll([new autogenerated.Text('\n                    '),
          __e9,
          new autogenerated.Text('\n                  ')]);
      });
      __e13 = __e19.nodes[3].nodes[1].nodes[3].nodes[1];
      __t.listen(__e13.onChange, ($event) { selectedSourceFilter = __e13.selectedIndex; });
      __t.oneWayBind(() => selectedSourceFilter, (e) { if (__e13.selectedIndex != e) __e13.selectedIndex = e; }, false, false);
      __t.loopIterateAttr(__e13, () => activeSourceLanguages, ($list, $index, __t) {
        var language = $list[$index];
        var __e12;
        __e12 = __html7.clone(true);
        var __binding11 = __t.contentBind(() => language.name, false);
        __e12.nodes.add(__binding11);
        __t.oneWayBind(() => language.code, (e) { if (__e12.value != e) __e12.value = e; }, false, false);
      __t.addAll([new autogenerated.Text('\n                      '),
          __e12,
          new autogenerated.Text('\n                  ')]);
      });
      __e16 = __e19.nodes[3].nodes[1].nodes[5].nodes[1];
      __t.listen(__e16.onChange, ($event) { selectedTargetFilter = __e16.selectedIndex; });
      __t.oneWayBind(() => selectedTargetFilter, (e) { if (__e16.selectedIndex != e) __e16.selectedIndex = e; }, false, false);
      __t.loopIterateAttr(__e16, () => activeTargetLanguages, ($list, $index, __t) {
        var language = $list[$index];
        var __e15;
        __e15 = __html8.clone(true);
        var __binding14 = __t.contentBind(() => language.name, false);
        __e15.nodes.add(__binding14);
        __t.oneWayBind(() => language.code, (e) { if (__e15.value != e) __e15.value = e; }, false, false);
      __t.addAll([new autogenerated.Text('\n                    '),
          __e15,
          new autogenerated.Text('\n                  ')]);
      });
      __e18 = __e19.nodes[3].nodes[3].nodes[1].nodes[1];
      var __binding17 = __t.contentBind(() => Localisation.getTranslationSafe("index_filter_task_stream"), false);
      __e18.nodes.addAll([new autogenerated.Text('\n                    '),
          __html9.clone(true),
          new autogenerated.Text(' '),
          __binding17,
          new autogenerated.Text('\n                  ')]);
      __t.listen(__e18.onClick, ($event) { filterStream(); });
    __t.addAll([new autogenerated.Text('\n          '),
        __e1,
        new autogenerated.Text('\n          '),
        __e19,
        new autogenerated.Text('\n          '),
        __html1.clone(true),
        new autogenerated.Text('\n        ')]);
    });

    __e79 = __root.nodes[3];
    __t.conditional(__e79, () => tasks.length > 0, (__t) {
      var __e75, __e78;
      __e75 = __html10.clone(true);
      __t.loop(__e75, () => tasks, ($list, $index, __t) {
        var task = $list[$index];
        var __e22, __e26, __e29, __e32, __e35, __e36, __e40, __e41, __e45, __e46, __e51, __e54, __e55, __e58, __e60, __e63, __e64, __e73, __e74;
        __e74 = __html11.clone(true);
        __e22 = __e74.nodes[1].nodes[1];
        var __binding21 = __t.contentBind(() => task.title, false);
        __e22.nodes.addAll([new autogenerated.Text('\n                  '),
            __binding21,
            new autogenerated.Text('\n                ')]);
        __t.bind(() => [new Settings().conf.urls.SiteLocation, task.id],  (__e) { __e22.href = autogenerated.sanitizeUri('${__e.newValue[0]}task/${__e.newValue[1]}/id'); }, false);
        __e36 = __e74.nodes[3];
        var __binding23 = __t.contentBind(() => Localisation.getTranslationSafe("common_type"), false);
        __e26 = __html12.clone(true);
        __t.conditional(__e26, () => task.taskType == 1, (__t) {
          var __e25;
          __e25 = __html13.clone(true);
          var __binding24 = __t.contentBind(() => Localisation.getTranslationSafe("common_segmentation"), false);
          __e25.nodes.add(__binding24);
          __t.bind(() => taskOneColour,  (__e) { __e25.attributes['style'] = 'background-color: ${__e.newValue}'; }, false);
        __t.addAll([new autogenerated.Text('\n                  '),
            __e25,
            new autogenerated.Text('\n                ')]);
        });

        __e29 = __html14.clone(true);
        __t.conditional(__e29, () => task.taskType == 2, (__t) {
          var __e28;
          __e28 = __html15.clone(true);
          var __binding27 = __t.contentBind(() => Localisation.getTranslationSafe("common_translation"), false);
          __e28.nodes.add(__binding27);
          __t.bind(() => taskTwoColour,  (__e) { __e28.attributes['style'] = 'background-color: ${__e.newValue}'; }, false);
        __t.addAll([new autogenerated.Text('\n                  '),
            __e28,
            new autogenerated.Text('\n                ')]);
        });

        __e32 = __html16.clone(true);
        __t.conditional(__e32, () => task.taskType == 3, (__t) {
          var __e31;
          __e31 = __html17.clone(true);
          var __binding30 = __t.contentBind(() => Localisation.getTranslationSafe("common_proofreading"), false);
          __e31.nodes.add(__binding30);
          __t.bind(() => taskThreeColour,  (__e) { __e31.attributes['style'] = 'background-color: ${__e.newValue}'; }, false);
        __t.addAll([new autogenerated.Text('\n                  '),
            __e31,
            new autogenerated.Text('\n                ')]);
        });

        __e35 = __html18.clone(true);
        __t.conditional(__e35, () => task.taskType == 4, (__t) {
          var __e34;
          __e34 = __html19.clone(true);
          var __binding33 = __t.contentBind(() => Localisation.getTranslationSafe("common_desegmentation"), false);
          __e34.nodes.add(__binding33);
          __t.bind(() => taskFourColour,  (__e) { __e34.attributes['style'] = 'background-color: ${__e.newValue}'; }, false);
        __t.addAll([new autogenerated.Text('\n                  '),
            __e34,
            new autogenerated.Text('              \n                ')]);
        });

        __e36.nodes.addAll([__binding23,
            new autogenerated.Text(':\n                '),
            __e26,
            new autogenerated.Text('\n                '),
            __e29,
            new autogenerated.Text('\n                '),
            __e32,
            new autogenerated.Text('\n                '),
            __e35,
            new autogenerated.Text('\n              ')]);
        __e41 = __e74.nodes[5];
        var __binding37 = __t.contentBind(() => Localisation.getTranslationSafe("common_from"), false);
        __e40 = __html20.clone(true);
        var __binding38 = __t.contentBind(() => task.sourceLocale.languageName, false);
        var __binding39 = __t.contentBind(() => task.sourceLocale.countryName, false);
        __e40.nodes.addAll([__binding38,
            new autogenerated.Text(' - '),
            __binding39,
            new autogenerated.Text(' ')]);
        __e41.nodes.addAll([new autogenerated.Text('\n                '),
            __binding37,
            new autogenerated.Text(': '),
            __e40,
            new autogenerated.Text('\n              ')]);
        __e46 = __e74.nodes[7];
        var __binding42 = __t.contentBind(() => Localisation.getTranslationSafe("common_to"), false);
        __e45 = __html21.clone(true);
        var __binding43 = __t.contentBind(() => task.targetLocale.languageName, false);
        var __binding44 = __t.contentBind(() => task.targetLocale.countryName, false);
        __e45.nodes.addAll([__binding43,
            new autogenerated.Text(' - '),
            __binding44]);
        __e46.nodes.addAll([new autogenerated.Text('\n                '),
            __binding42,
            new autogenerated.Text(': '),
            __e45,
            new autogenerated.Text('\n              ')]);
        __e51 = __e74.nodes[9].nodes[1];
        __t.conditional(__e51, () => taskTags[task.id].length > 0, (__t) {
          var __e50;
          __e50 = __html22.clone(true);
          __t.loop(__e50, () => taskTags[task.id], ($list, $index, __t) {
            var tag = $list[$index];
            var __e48, __e49;
            __e49 = __html23.clone(true);
            __e48 = __e49.nodes[0];
            var __binding47 = __t.contentBind(() => tag.label, false);
            __e48.nodes.add(__binding47);
            __t.bind(() => [siteAddress, tag.id],  (__e) { __e49.href = autogenerated.sanitizeUri('${__e.newValue[0]}tag/${__e.newValue[1]}'); }, false);
          __t.addAll([new autogenerated.Text('\n                    '),
              __e49,
              new autogenerated.Text('\n                  ')]);
          });
        __t.addAll([new autogenerated.Text('\n                  '),
            __e50,
            new autogenerated.Text('\n                ')]);
        });

        __e55 = __e74.nodes[11];
        var __binding52 = __t.contentBind(() => Localisation.getTranslationSafe("common_word_count"), false);
        __e54 = __html24.clone(true);
        var __binding53 = __t.contentBind(() => task.wordCount, false);
        __e54.nodes.add(__binding53);
        __e55.nodes.addAll([new autogenerated.Text('\n                '),
            __binding52,
            new autogenerated.Text(': '),
            __e54,
            new autogenerated.Text('\n              ')]);
        __e60 = __e74.nodes[13];
        var __binding56 = __t.contentBind(() => Localisation.getTranslationSafe("common_added"), false);
        __e58 = __html25.clone(true);
        var __binding57 = __t.contentBind(() => taskAges[task.id], false);
        __e58.nodes.add(__binding57);
        var __binding59 = __t.contentBind(() => Localisation.getTranslationSafe("common_ago"), false);
        __e60.nodes.addAll([new autogenerated.Text('\n                '),
            __binding56,
            new autogenerated.Text(': '),
            __e58,
            new autogenerated.Text(' '),
            __binding59,
            new autogenerated.Text('\n              ')]);
        __e64 = __e74.nodes[15];
        var __binding61 = __t.contentBind(() => Localisation.getTranslationSafe("common_due_by"), false);
        __e63 = __html26.clone(true);
        var __binding62 = __t.contentBind(() => task.deadline, false);
        __e63.nodes.add(__binding62);
        __e64.nodes.addAll([new autogenerated.Text('\n                '),
            __binding61,
            new autogenerated.Text(': '),
            __e63,
            new autogenerated.Text('\n              ')]);
        __e73 = __e74.nodes[17];
        __t.conditional(__e73, () => projectMap[task.projectId] != null, (__t) {
          var __e72;
          __e72 = __html27.clone(true);
          __t.conditional(__e72, () => orgMap[projectMap[task.projectId].organisationId] != null, (__t) {
            var __e67, __e70, __e71;
            __e71 = __html28.clone(true);
            var __binding65 = __t.contentBind(() => Localisation.getTranslationSafe("common_part_of"), false);
            __e67 = __html29.clone(true);
            var __binding66 = __t.contentBind(() => projectMap[task.projectId].title, false);
            __e67.nodes.addAll([new autogenerated.Text('\n                      '),
                __binding66,
                new autogenerated.Text('\n                    ')]);
            __t.bind(() => [siteAddress, projectMap[task.projectId].id],  (__e) { __e67.href = autogenerated.sanitizeUri('${__e.newValue[0]}project/${__e.newValue[1]}/view'); }, false);
            var __binding68 = __t.contentBind(() => Localisation.getTranslationSafe("common_for"), false);
            __e70 = __html30.clone(true);
            var __binding69 = __t.contentBind(() => orgMap[projectMap[task.projectId].organisationId].name, false);
            __e70.nodes.addAll([new autogenerated.Text('\n                      '),
                __binding69,
                new autogenerated.Text('\n                    ')]);
            __t.bind(() => [siteAddress, orgMap[projectMap[task.projectId].organisationId].id],  (__e) { __e70.href = autogenerated.sanitizeUri('${__e.newValue[0]}org/${__e.newValue[1]}/profile'); }, false);
            __e71.nodes.addAll([new autogenerated.Text('\n                    '),
                __binding65,
                new autogenerated.Text(':\n                    '),
                __e67,
                new autogenerated.Text('\n                    '),
                __binding68,
                new autogenerated.Text('\n                    '),
                __e70,
                new autogenerated.Text('\n                  ')]);
          __t.addAll([new autogenerated.Text('\n                  '),
              __e71,
              new autogenerated.Text('\n                ')]);
          });

        __t.addAll([new autogenerated.Text('\n                '),
            __e72,
            new autogenerated.Text('\n              ')]);
        });

      __t.addAll([new autogenerated.Text('\n            '),
          __e74,
          new autogenerated.Text('\n          ')]);
      });
      __e78 = __html31.clone(true);
      __t.conditional(__e78, () => moreTasks, (__t) {
        var __e77;
        __e77 = __html32.clone(true);
        var __binding76 = __t.contentBind(() => Localisation.getTranslationSafe("index_load_more"), false);
        __e77.nodes.add(__binding76);
        __t.listen(__e77.onClick, ($event) { addTasks(); });
      __t.addAll([new autogenerated.Text('\n            '),
          __e77,
          new autogenerated.Text('\n          ')]);
      });

    __t.addAll([new autogenerated.Text('\n          '),
        __e75,
        new autogenerated.Text('\n          '),
        __e78,
        new autogenerated.Text('\n        ')]);
    });

    __e82 = __root.nodes[5];
    __t.conditional(__e82, () => !(tasks.length > 0), (__t) {
      var __e81;
      __e81 = __html33.clone(true);
      var __binding80 = __t.contentBind(() => Localisation.getTranslationSafe("index_no_tasks_available"), false);
      __e81.nodes.add(__binding80);
    __t.addAll([new autogenerated.Text('\n          '),
        __e81,
        new autogenerated.Text('\n        ')]);
    });

    __t.create();
  }

  void inserted_autogenerated() {
    __t.insert();
  }

  void removed_autogenerated() {
    __t.remove();
    __t = __e20 = __e79 = __e82 = null;
  }

  /** Original code from the component. */

  static const int limit = 10;
  
  String siteAddress;
  int taskCount = 0;
  String filter = '';
  int userId = 0;
  int selectedTaskTypeFilter = 0;
  int selectedSourceFilter = 0;
  int selectedTargetFilter = 0;
  DateTime currentDateTime;
  String __$taskOneColour;
  String get taskOneColour {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'taskOneColour');
    }
    return __$taskOneColour;
  }
  set taskOneColour(String value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'taskOneColour',
          __$taskOneColour, value);
    }
    __$taskOneColour = value;
  }
  String __$taskTwoColour;
  String get taskTwoColour {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'taskTwoColour');
    }
    return __$taskTwoColour;
  }
  set taskTwoColour(String value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'taskTwoColour',
          __$taskTwoColour, value);
    }
    __$taskTwoColour = value;
  }
  String __$taskThreeColour;
  String get taskThreeColour {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'taskThreeColour');
    }
    return __$taskThreeColour;
  }
  set taskThreeColour(String value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'taskThreeColour',
          __$taskThreeColour, value);
    }
    __$taskThreeColour = value;
  }
  String __$taskFourColour;
  String get taskFourColour {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'taskFourColour');
    }
    return __$taskFourColour;
  }
  set taskFourColour(String value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'taskFourColour',
          __$taskFourColour, value);
    }
    __$taskFourColour = value;
  }
  bool __$moreTasks = true;
  bool get moreTasks {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'moreTasks');
    }
    return __$moreTasks;
  }
  set moreTasks(bool value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'moreTasks',
          __$moreTasks, value);
    }
    __$moreTasks = value;
  }
  List<Task> __$tasks;
  List<Task> get tasks {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'tasks');
    }
    return __$tasks;
  }
  set tasks(List<Task> value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'tasks',
          __$tasks, value);
    }
    __$tasks = value;
  }
  Map<int, String> __$taskAges;
  Map<int, String> get taskAges {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'taskAges');
    }
    return __$taskAges;
  }
  set taskAges(Map<int, String> value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'taskAges',
          __$taskAges, value);
    }
    __$taskAges = value;
  }
  Map<int, Project> __$projectMap;
  Map<int, Project> get projectMap {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'projectMap');
    }
    return __$projectMap;
  }
  set projectMap(Map<int, Project> value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'projectMap',
          __$projectMap, value);
    }
    __$projectMap = value;
  }
  Map<int, Organisation> __$orgMap;
  Map<int, Organisation> get orgMap {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'orgMap');
    }
    return __$orgMap;
  }
  set orgMap(Map<int, Organisation> value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'orgMap',
          __$orgMap, value);
    }
    __$orgMap = value;
  }
  List<Language> __$activeSourceLanguages;
  List<Language> get activeSourceLanguages {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'activeSourceLanguages');
    }
    return __$activeSourceLanguages;
  }
  set activeSourceLanguages(List<Language> value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'activeSourceLanguages',
          __$activeSourceLanguages, value);
    }
    __$activeSourceLanguages = value;
  }
  List<Language> __$activeTargetLanguages;
  List<Language> get activeTargetLanguages {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'activeTargetLanguages');
    }
    return __$activeTargetLanguages;
  }
  set activeTargetLanguages(List<Language> value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'activeTargetLanguages',
          __$activeTargetLanguages, value);
    }
    __$activeTargetLanguages = value;
  }
  Map<int, SafeHtml> __$taskTypes;
  Map<int, SafeHtml> get taskTypes {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'taskTypes');
    }
    return __$taskTypes;
  }
  set taskTypes(Map<int, SafeHtml> value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'taskTypes',
          __$taskTypes, value);
    }
    __$taskTypes = value;
  }
  List<int> __$taskTypeIndexes;
  List<int> get taskTypeIndexes {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'taskTypeIndexes');
    }
    return __$taskTypeIndexes;
  }
  set taskTypeIndexes(List<int> value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'taskTypeIndexes',
          __$taskTypeIndexes, value);
    }
    __$taskTypeIndexes = value;
  }
  Map<int, List<Tag>> __$taskTags;
  Map<int, List<Tag>> get taskTags {
    if (__observe.observeReads) {
      __observe.notifyRead(this, __observe.ChangeRecord.FIELD, 'taskTags');
    }
    return __$taskTags;
  }
  set taskTags(Map<int, List<Tag>> value) {
    if (__observe.hasObservers(this)) {
      __observe.notifyChange(this, __observe.ChangeRecord.FIELD, 'taskTags',
          __$taskTags, value);
    }
    __$taskTags = value;
  }
  
  TaskStream()
  {
    Settings settings = new Settings();
    siteAddress = settings.conf.urls.SiteLocation;
    currentDateTime = new DateTime.now();
    tasks = toObservable(new List<Task>());
    taskAges = toObservable(new Map<int, String>());
    projectMap = toObservable(new Map<int, Project>());    
    orgMap = toObservable(new Map<int, Organisation>());
    activeSourceLanguages = toObservable(new List<Language>());
    activeTargetLanguages = toObservable(new List<Language>());
    taskTypes = toObservable(new Map<int, String>());
    taskTypeIndexes = toObservable(new List<int>());
    taskTags = toObservable(new Map<int, List<Tag>>());
  }
  
  void inserted()
  {
    Settings settings = new Settings();
    settings.loadConf().then((e) {
      loadActiveLanguages();
      addTasks();
      taskTypeIndexes.add(0);
      taskTypes[0] = Localisation.getTranslationSafe("index_any");
      taskTypeIndexes.add(1);
      taskTypes[1] = Localisation.getTranslationSafe("common_segmentation");
      taskOneColour = settings.conf.task_colours.colour_1;
      taskTypeIndexes.add(2);
      taskTypes[2] = Localisation.getTranslationSafe("common_translation");
      taskTwoColour = settings.conf.task_colours.colour_2;
      taskTypeIndexes.add(3);
      taskTypes[3] = Localisation.getTranslationSafe("common_proofreading");
      taskThreeColour = settings.conf.task_colours.colour_3;
      taskTypeIndexes.add(4);
      taskTypes[4] = Localisation.getTranslationSafe("common_desegmentation");
      taskFourColour = settings.conf.task_colours.colour_4;
    });
  }
  
  void loadActiveLanguages()
  {
    Language any = new Language();
    any.name = Localisation.getTranslation("index_any").toString();
    any.code = "";
    
    activeSourceLanguages.add(any);
    activeTargetLanguages.add(any);
    LanguageDao.getActiveSourceLanguages().then((List<Language> langs) {
      activeSourceLanguages.addAll(langs);
    });
    LanguageDao.getActiveTargetLanguages().then((List<Language> langs) {
      activeTargetLanguages.addAll(langs);
    });
  }
  
  void addTasks()
  {
    int offset = taskCount;
    if (userId > 0) {
      TaskDao.getUserTopTasks(userId, offset, limit, filter)
              .then((List<Task> userTasks) => processTaskList(userTasks));
    } else {
      TaskDao.getLatestAvailableTasks(offset, limit)
              .then((List<Task> tasks) => processTaskList(tasks));
    }
  }
  
  void processTaskList(List<Task> tasks)
  {
    if (tasks.length > 0) {
      if (tasks.length < limit) {
        moreTasks = false;
      }
      if (tasks.length > 0) {
        tasks.forEach((Task task) {
          addTask(task);
        });
      }
    } else {
      moreTasks = false;
    }
  }
  
  void addTask(Task task)
  {
    tasks.add(task);
    DateTime taskTime = DateTime.parse(task.createdTime);
    Duration dur = currentDateTime.difference(taskTime);
    if (dur.inDays > 0) {
      taskAges[task.id] = dur.inDays.toString() + " day(s)";
    } else if (dur.inHours > 0) {
      taskAges[task.id] = dur.inHours.toString() + " hour(s)";
    } else if (dur.inMinutes > 0) {
      taskAges[task.id] = dur.inMinutes.toString() + " minutes(s)";
    } else {
      taskAges[task.id] = dur.inSeconds.toString() + " second(s)";
    }
    taskTags[task.id] = new List<Tag>();
    TaskDao.getTaskTags(task.id).then((List<Tag> tags) {
      taskTags[task.id] = tags;
    });
    taskCount++;
    if (!projectMap.containsKey(task.projectId)) {
      ProjectDao.getProject(task.projectId).then((Project proj) {
        projectMap[proj.id] = proj;
        OrgDao.getOrg(proj.organisationId).then((Organisation org) {
          orgMap[org.id] = org;
        });
      });
    }
  }
  
  void filterStream()
  {
    filter = "";
    if (selectedTaskTypeFilter > 0) {
      filter += "taskType:" + selectedTaskTypeFilter.toString() + ";";                
    }
    if (selectedSourceFilter > 0) {
      filter += "sourceLanguage:" + activeSourceLanguages.elementAt(selectedSourceFilter).code + ";";
    }
    if (selectedTargetFilter > 0) {
      filter += "targetLanguage:" + activeTargetLanguages.elementAt(selectedTargetFilter).code + ";";
    }
    tasks.clear();
    taskCount = 0;
    moreTasks = true;
    TaskDao.getUserTopTasks(userId, taskCount, limit, filter)
            .then((List<Task> userTasks) => processTaskList(userTasks));
  }
}

//# sourceMappingURL=TaskStream.dart.map